{"version":3,"sources":["webpack://@flamarkt/backoffice/webpack/bootstrap","webpack://@flamarkt/backoffice/external \"flarum.core.compat['common/app']\"","webpack://@flamarkt/backoffice/external \"flarum.core.compat['common/extend']\"","webpack://@flamarkt/backoffice/external \"flarum.core.compat['common/Model']\"","webpack://@flamarkt/backoffice/external \"flarum.core.compat['common/components/LinkButton']\"","webpack://@flamarkt/backoffice/./src/common/registerPatchInitializer.ts","webpack://@flamarkt/backoffice/./src/common/patchModelHasOneNull.ts","webpack://@flamarkt/backoffice/./src/common/patchStoreAllowVerbatimRelationships.ts","webpack://@flamarkt/backoffice/external \"flarum.core.compat['admin/app']\"","webpack://@flamarkt/backoffice/external \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@flamarkt/backoffice/external \"flarum.core.compat['admin/components/SessionDropdown']\"","webpack://@flamarkt/backoffice/external \"flarum.core.compat['common/components/Separator']\"","webpack://@flamarkt/backoffice/./src/admin/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","app","initializers","add","override","Model","original","model","this","data","relationships","relationship","verbatim","ExtensionPage","extension","extra","settingsInBackoffice","href","id","translator","trans","extend","SessionDropdown","items","LinkButton","component","icon","forum","attribute","external","has","Separator","registerPatchInitializer"],"mappings":"2BACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,I,gBClFrDhC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,e,cCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,kB,cCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,iB,cCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,iC,wECIrB,eAGXC,IAAIC,aAAaC,IAAI,6BAA6B,WCElDC,mBAASC,IAAO,iBAAwB,SAAUC,EAAiCC,GAC/E,OAAKA,EAIED,EAASC,GAHL,QAQfH,mBAASC,IAAO,UAAU,SAAUC,EAAyCjC,GACzE,OAAO,WACH,GAAImC,KAAKC,KAAKC,cAAe,CACzB,IAAMC,EAAeH,KAAKC,KAAKC,cAAcrC,GAE7C,GAAIsC,IAAiBA,EAAaF,KAE9B,OAAO,KAIf,OAAOH,EAASjC,GAAMJ,KAAKuC,UCrBnCJ,mBAASC,IAAO,iBAAwB,SAAUC,EAAiCC,GAE/E,OAAKA,EAIDA,EAAMK,iBACCL,EAAMK,SAENL,GAGJD,EAASC,GATL,UFFZ,O,eGVP1C,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,c,0BCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,mC,cCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,qC,cCApCnC,EAAOD,QAAUkC,OAAOC,KAAKC,OAAO,gC,0ICQpCC,IAAIC,aAAaC,IAAI,uBAAuB,WACxCC,mBAASS,IAAcnB,UAAW,WAAW,SAAUY,GACnD,OAAKE,KAAKM,UAAUC,MAAM,wBAA2BP,KAAKM,UAAUC,MAAM,uBAAuBC,qBAI1F9C,EAAE,0BAA2BA,EAAE,aAAcA,EAAE,cAAeA,EAAE,WAAY,CAC/E+C,KAAM,yBAA2BT,KAAKM,UAAUI,IACjDjB,IAAIkB,WAAWC,MAAM,sDALbd,OAQfe,iBAAOC,IAAgB5B,UAAW,SAAS,SAAU6B,GACjDA,EAAMpB,IAAI,sBAAuBqB,IAAWC,UAAU,CAClDC,KAAM,wBACNT,KAAMhB,IAAI0B,MAAMC,UAAU,iBAC1BC,UAAU,GACX5B,IAAIkB,WAAWC,MAAM,sDAGnBG,EAAMO,IAAI,cACXP,EAAMpB,IAAI,YAAa4B,IAAUN,aAAc,UAK3DO","file":"admin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 23);\n","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/components/LinkButton'];","import app from 'flarum/common/app';\nimport patchModelHasOneNull from './patchModelHasOneNull';\nimport patchStoreAllowVerbatimRelationships from './patchStoreAllowVerbatimRelationships';\n\nexport default function () {\n    // On one hand these need to run as early as possible because they need to override Model.hasOne which is used in other extension's extenders\n    // But priority might need to be adjusted because it need to run as late as possible for the null catch to be the most outward override and therefore runs before other overrides\n    app.initializers.add('flamarkt-backoffice-patch', () => {\n        patchModelHasOneNull();\n        patchStoreAllowVerbatimRelationships();\n    }, 100);\n}\n","import {override} from 'flarum/common/extend';\nimport Model from 'flarum/common/Model';\n\n/**\n * Fixes inability to use null hasOne relationships with Flarum javascript models\n * @see https://github.com/flarum/core/issues/2876\n */\nexport default function () {\n    // Allow passing null relationships in Model.prototype.save()\n    override(Model, 'getIdentifier' as any, function (original: (model: Model) => any, model: Model | any) {\n        if (!model) {\n            return null;\n        }\n\n        return original(model);\n    });\n\n    // Don't error if the data property exists on the relationship but is null\n    // null is allowed as per https://jsonapi.org/format/#document-resource-object-linkage\n    override(Model, 'hasOne', function (original: (name: string) => (() => any), name: string) {\n        return function (this: Model) {\n            if (this.data.relationships) {\n                const relationship = this.data.relationships[name];\n\n                if (relationship && !relationship.data) {\n                    // Flarum might use false here. The code only looks for falsy for now anyway\n                    return null;\n                }\n            }\n\n            return original(name).call(this);\n        };\n    });\n}\n","import {override} from 'flarum/common/extend';\nimport Model from 'flarum/common/Model';\n\n/**\n * The way Flarum parses relationships inside of the save() method prevents us from saving data alongside the relation\n * To work around this, we override this method that will allow us to pass down raw objects directly in the model during save\n * The same code is used in fof/taxonomies\n */\nexport default function () {\n    override(Model, 'getIdentifier' as any, function (original: (model: Model) => any, model: Model | any) {\n        // This is fixed by patchModelHasOneNull but we need to handle it here as well depending on the load order\n        if (!model) {\n            return null;\n        }\n\n        if (model.verbatim) {\n            delete model.verbatim;\n\n            return model;\n        }\n\n        return original(model);\n    });\n}\n","module.exports = flarum.core.compat['admin/app'];","module.exports = flarum.core.compat['admin/components/ExtensionPage'];","module.exports = flarum.core.compat['admin/components/SessionDropdown'];","module.exports = flarum.core.compat['common/components/Separator'];","import app from 'flarum/admin/app';\nimport {extend, override} from 'flarum/common/extend';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport SessionDropdown from 'flarum/admin/components/SessionDropdown';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport Separator from 'flarum/common/components/Separator';\nimport registerPatchInitializer from '../common/registerPatchInitializer';\n\napp.initializers.add('flamarkt-backoffice', () => {\n    override(ExtensionPage.prototype, 'content', function (original) {\n        if (!this.extension.extra['flamarkt-backoffice'] || !this.extension.extra['flamarkt-backoffice'].settingsInBackoffice) {\n            return original();\n        }\n\n        return m('.ExtensionPage-settings', m('.container', m('.Form-group', m('a.Button', {\n            href: '/backoffice/extension/' + this.extension.id,\n        }, app.translator.trans('flamarkt-backoffice.admin.settingsInBackoffice')))));\n    });\n\n    extend(SessionDropdown.prototype, 'items', function (items) {\n        items.add('flamarkt-backoffice', LinkButton.component({\n            icon: 'fas fa-tachometer-alt',\n            href: app.forum.attribute('backofficeUrl'),\n            external: true,\n        }, app.translator.trans('flamarkt-backoffice.lib.header.backoffice_button')));\n\n        // Add a separator between links and logout button, just like in the forum frontend\n        if (!items.has('separator')) {\n            items.add('separator', Separator.component(), -90);\n        }\n    });\n});\n\nregisterPatchInitializer();\n"],"sourceRoot":""}